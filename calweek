#!/usr/bin/python3

import datetime
import sys

from pytz import timezone

import cal
import timezones

days_to_display = 14

def display_time_from_unix(unix, tz):
    d = datetime.datetime.fromtimestamp(unix).astimezone(
        timezone(timezones.TIMEZONES[tz]))
    display_date = d.strftime("%Y-%m-%d")
    display_time = d.strftime("%H:%M")
    return (display_date, display_time)

if len(sys.argv) >=2:
    tz = sys.argv[1]
else:
    tz = "UTC"

current_date = ""
current_date_from_output = None
events = cal.get_events_for_next_n_days(days_to_display)
for e in events:
    (start, end, title) = e
    separator = " -> "
    (s_d, s_t) = display_time_from_unix(int(start), tz)
    display_date = s_d
    if s_d == current_date:
        display_date = " " * len("YYYY-MM-DD")
    else:
        print("-" * 80)
    (_, e_t) = display_time_from_unix(int(end), tz)
    print(""
          "" + display_date + "  " + s_t + ""
          "" + separator + ""
          "" + e_t + " "
          "  " + title)
    current_date = s_d
