#!/usr/bin/python3

import argparse
import shlex
import subprocess

import cal

def print_dashboard(timezone="UTC"):
    """Prints the dashboard"""
    events = cal.process_calcurse(
        subprocess.check_output(shlex.split("calcurse -d 7")).decode())
    birthdays = cal.get_birthdays()

    arguments = [
        ["Today", "yellow"],
        ["Tomorrow", "cyan"],
        ["After tomorrow", "green"],
        ["", "dim"],
        ["", "dim"],
        ["", "dim"],
        ["", "dim"],
        ["", "dim"],
    ]

    print("")
    for i in range(len(arguments)):
        title = arguments[i][0]
        # TODO: This is silly. Bundle.
        weekday = cal.get_weekday_n_days_from_today(i, timezone)
        day_of_month = cal.get_day_of_month_n_days_from_today(i, timezone)
        month = cal.get_month_n_days_from_today(i, timezone)
        weekday_and_day_of_month = weekday + " " + str(day_of_month)
        if title == "":
            title = weekday_and_day_of_month
        else:
            title = title + " (" + weekday_and_day_of_month + ")"

        birthdays_today = []
        for b in birthdays:
            if b[1] == day_of_month and b[2] == month:
                birthdays_today.append(b[0])
        cal.pretty_print_single_day(events,
                                    birthdays_today,
                                    cal.is_today_from_n_days_partial(i),
                                    title, arguments[i][1], "yellow", timezone)

if __name__ == "__main__":
    # TODO: Use the time zone
    parser = argparse.ArgumentParser()
    parser.add_argument("-f", dest="full", action="store_true",
                        help="Show full descriptions")
    parser.add_argument("timezone", nargs="?", default="UTC")
    args = parser.parse_args()

    print_dashboard(args.timezone)
